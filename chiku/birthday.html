<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday!</title>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(120deg, #0ea5e9, #9333ea, #f59e0b);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-family: sans-serif;
      color: #fff;
      text-align: center;
      overflow: hidden;
    }
    .banner-img {
      width: 450px;
      margin: 36px auto 0 auto;
      display: block;
      filter: drop-shadow(0 3px 12px #0005);
    }
    .birthday-counter {
      background: rgba(255,255,255,0.18);
      color: #fff;
      font-weight: bold;
      font-size: 1.7em;
      letter-spacing: 2px;
      margin: 12px auto;
      border-radius: 19px;
      padding: 10px 26px;
      box-shadow: 0 4px 24px #00000050;
      width: fit-content;
      text-shadow: 0 2px 6px #00000066;
    }
    .cake {
      display: block;
      margin: 0 auto 22px auto;
      width: 140px;
      filter: drop-shadow(0 2px 12px #0007);
    }
    .photo {
      width: 220px;
      height: 220px;
      border-radius: 50%;
      border: 6px solid #fff;
      object-fit: cover;
      box-shadow: 0 8px 24px #00000060;
      margin-bottom: 20px;
    }
    h1 {
      font-size: 3em;
      margin: 0;
      text-shadow: 0 2px 8px #0004;
    }
    .subtitle {
      margin-top: 10px;
      font-size: 1.2em;
    }
    .balloon {
      position: absolute;
      bottom: -120px;
      width: 52px;
      height: 68px;
      border-radius: 60% 60% 60% 60% / 70% 70% 50% 50%;
      box-shadow: inset -6px -10px 18px #00000020, 0 10px 18px #00000025;
      animation: floatUp var(--dur, 9s) linear forwards;
    }
    .balloon::after {
      content: "";
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: -10px;
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 10px solid rgba(0,0,0,.15);
    }
    .string {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: -110px;
      width: 1px;
      height: 110px;
      background: #0000002b;
    }
    @keyframes floatUp {
      0% { transform:translateY(0) translateX(0);opacity:0 }
      10% { opacity: 1 }
      100% { transform:translateY(-110vh) translateX(var(--drift,0px));opacity:.8 }
    }
    .confetti-piece {
      position: absolute; top: -10px;
      width: var(--w,8px); height: var(--h,14px);
      background: var(--c,#fff);
      opacity: .9;
      animation: fall var(--dur,7s) linear infinite;
    }
    @keyframes fall { to { transform:translateY(110vh) rotate(360deg) } }
    #music { display: none; }
  </style>
</head>
<body>
  <img src="./banner.png" alt="Happy Birthday Banner" class="banner-img">
  <div class="birthday-counter" id="counter"></div>
  <div>
    <img 
    src="./cake.gif" 
    alt="Birthday Cake" 
    class="cake" 
    style="width:140px; margin: 0 auto 22px auto; filter: drop-shadow(0 2px 12px #0007); display: block;"
  />
  
    <img class="photo" src="./istockphoto-1193994027-612x612.jpg" alt="Birthday Boy">
    <h1 id="title">Happy Birthday, Champ! ðŸŽ‰</h1>
    <div class="subtitle">Wishing you lots of fun, joy, and cake!</div>
  </div>
  <div id="balloons"></div>
  <div id="confetti"></div>
  <audio id="music" src="./happy-birthday-to-you-bossa-nova-style-arrangement-21399.mp3" autoplay muted preload="auto" playsinline></audio>
  <script>
    // Balloons
    const balloonsLayer = document.getElementById('balloons');
    function releaseBalloons() {
      const count = 6 + Math.floor(Math.random() * 4);
      for (let i = 0; i < count; i++) {
        const b = document.createElement('div');
        b.className = 'balloon';
        const hue = Math.floor(Math.random() * 360);
        const color = `hsl(${hue}deg,85%,60%)`;
        b.style.background = `radial-gradient(120% 100% at 20% 20%, #ffffffb0, ${color})`;
        b.style.left = Math.random() * 100 + 'vw';
        b.style.setProperty('--dur', (7 + Math.random() * 6).toFixed(2) + 's');
        b.style.setProperty('--drift', (Math.random() * 120 - 60).toFixed(0) + 'px');
        const string = document.createElement('div');
        string.className = 'string';
        b.appendChild(string);
        balloonsLayer.appendChild(b);
        b.addEventListener('animationend', () => b.remove());
      }
    }
    // Confetti
    const confettiLayer = document.getElementById('confetti');
    function sprinkleConfetti() {
      const colors = ['#f43f5e', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ef4444', '#22c55e', '#eab308'];
      const pieces = 120;
      for (let i = 0; i < pieces; i++) {
        const c = document.createElement('div');
        c.className = 'confetti-piece';
        c.style.left = Math.random() * 100 + 'vw';
        c.style.setProperty('--c', colors[i % colors.length]);
        c.style.setProperty('--w', (6 + Math.random() * 8) + 'px');
        c.style.setProperty('--h', (8 + Math.random() * 16) + 'px');
        c.style.setProperty('--dur', (6 + Math.random() * 6) + 's');
        c.style.animationDelay = (Math.random() * 6) + 's';
        confettiLayer.appendChild(c);
      }
    }
    function startVisuals(){
      sprinkleConfetti();
      setInterval(releaseBalloons, 2000);
      releaseBalloons();
    }
    // Music playback
    const music = document.getElementById('music');
    function tryPlay(){
      if(!music) return;
      try{ music.load(); }catch(e){}
      const p = music.play();
      if(p && typeof p.then==='function'){
        p.then(()=>{
          music.muted=false;
          music.volume=0.8;
          setTimeout(()=>{
            music.pause();
            music.currentTime=0;
          },20000);
        }).catch(()=>{
          armUserGesturePlayback();
        });
      }
    }
    function armUserGesturePlayback(){
      const resume = ()=>{
        const r = music.play();
        if(r && typeof r.then==='function'){
          r.then(()=>{
            music.muted=false; music.volume=0.8;
            setTimeout(()=>{music.pause(); music.currentTime=0;},20000);
            cleanup();
          });
        }
      };
      const cleanup = ()=>{
        ['pointerdown','touchstart','mousedown','keydown','click'].forEach(ev=>document.removeEventListener(ev,resume));
      };
      ['pointerdown','touchstart','mousedown','keydown','click'].forEach(ev=>document.addEventListener(ev,resume,{once:false}));
    }
    window.addEventListener('load', ()=>{
      startVisuals();
      tryPlay();
    });
    window.addEventListener('pageshow', ()=>{ tryPlay(); });

    // Birthday Counter Logic
    const counter = document.getElementById('counter');
    const bDate = new Date(2025, 8, 16); // Month is 0-based!
    const now = new Date();
    let yearDiff = now.getFullYear() - bDate.getFullYear();
    let hasHadBirthday = (now.getMonth() > 8 || (now.getMonth() === 8 && now.getDate() >= 16));
    if (!hasHadBirthday) { yearDiff -= 1; }
    if (yearDiff > 0) {
      counter.textContent = yearDiff === 1 ? "ðŸŽ‰ Happy 1st Birthday! ðŸŽ‰" :
        yearDiff === 2 ? "ðŸŽˆ Happy 2nd Birthday! ðŸŽˆ" :
        `âœ¨ Happy ${yearDiff}th Birthday! âœ¨`;
    } else {
      counter.textContent = "ðŸŽ‚ Happy 1st Birthday! ðŸŽ‚";
    }
    // Personalize name if present
    const params = new URLSearchParams(location.search);
    const name = params.get('name');
    if(name){
      document.getElementById('title').textContent=`Happy Birthday, ${name}! ðŸŽ‰`;
      document.title=`ðŸŽ‚ Happy Birthday, ${name}!`;
    }
  </script>
</body>
</html>
